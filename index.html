<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>変環ガチャ！ | 名古屋大学 変換共創拠点</title>
</head>
<body>

<style>
.modal{position:fixed;left:0;top:0;display:none;z-index:9999;height:100%;width:100%;overflow:auto;background-color:rgba(0,0,0,0.5);}
.modal-btn{float:left;margin:10px auto;height:auto;text-align:center;width:100%;max-width:300px;}
.modal-header{border-bottom:1px solid #e4e4e4;padding:3px 20px;display:flex;justify-content:center;align-items:center;}
.modal-body{padding:20px;color:black;position:relative;z-index:0;}
.modal-content{background-color:#f4f4f4;border-radius:30px;margin:10% auto;width:90%;max-width:500px;}
.clear{clear:both;}
#playGif{width:100%;height:auto;margin:auto;display:block;}

/* @keyframes flash{0%,100%{box-shadow:0 0 20px 10px rgba(255,215,0,.7);}50%{box-shadow:0 0 40px 20px rgba(255,215,0,1);}}
@keyframes shake{0%{transform:translate(0,0) rotate(0);}20%{transform:translate(-2px,2px) rotate(-1deg);}40%{transform:translate(2px,-2px) rotate(1deg);}60%{transform:translate(-1px,1px) rotate(0);}80%{transform:translate(1px,-1px) rotate(-1deg);}100%{transform:translate(0,0) rotate(0);}}
.shake{animation:shake .6s ease-in-out infinite;} */

/* .modal-body::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle,rgba(255,255,0,.2) 0%,transparent 70%);animation:shimmer 2s infinite linear;pointer-events:none;z-index:1;}
@keyframes shimmer{0%{transform:translateX(-50%) scale(1);opacity:.5;}50%{transform:translateX(50%) scale(1.2);opacity:1;}100%{transform:translateX(-50%) scale(1);opacity:.5;}} */

/* 紙吹雪（長方形・ひらひら） */
.confetti{position:absolute;left:0;width:6px;height:12px;background:red;opacity:.9;z-index:99999;border-radius:0;animation:fall var(--duration,8s) linear forwards,spin var(--duration,8s) ease-in-out forwards;transform-origin:center;pointer-events:none;}
@keyframes fall{0%{top:-10px;left:var(--startX,50vw);}100%{top:100vh;left:var(--endX,60vw);opacity:0;}}
@keyframes spin{0%{transform:rotate3d(1,1,0,0deg) skew(0,0);}100%{transform:rotate3d(1,1,0,720deg) skew(10deg,5deg);}}

/* ▼ 結果画像（最初は非表示） */
.result-wrap{margin-top:12px;position:relative;z-index:2;display:none;}
.result-img{width:100%;display:block;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.12);opacity:0;transition:opacity .6s ease;}
.result-img.show{opacity:1;}
.result-link{display:none;margin-top:16px;text-align:center;text-decoration:underline;color:#0b5bd3;font-weight:600;position:relative;z-index:2;}
</style>

<div id="gachaModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>変環ステッカーガチャ!　</h3>
      <h2 id="gachaTitleTxt"></h2>
    </div>
    <div class="modal-body">
      <img id="playGif" src="" alt="抽選のアニメーション">
      <p>アニメーションが終わると、下にランダムで1枚だけ表示されます。</p>

      <!-- ▼ 結果（PNG 1枚だけ） -->
      <div id="resultWrap" class="result-wrap">
        <img id="resultImg" class="result-img" src="" alt="ランダム結果">
      </div>

      <!-- ▼ 一番下の文字リンク -->
      <a id="resultLink" class="result-link" href="#" target="_blank" rel="noopener">記事をひらく</a>

      <!-- ▼ 閉じる -->
      <button class="js-result" style="margin-top:12px;">閉じる</button>
    </div>
  </div>
</div>

<!-- ガチャ本体 -->
<div class="modal-btn" onclick="choiceGachaBox(0)" style="cursor:pointer;">
  <img loading="lazy" src="image1.png" width="250" height="400" alt="論文・レポートのガチャ">
  <p>変換共創拠点のステッカー全4種<br>画像がランダムに開きます</p>
</div>
<div class="clear"></div>

<script>
/* ===== 設定 ===== */
const GIF_DURATION_MS = 8000; // GIFが終わるまでの待ち時間（必要なら調整）

/* ランダム記事（文字リンク用） */
const GachaList = [[
  "https://note.com/hc3_henkan/n/n3dd0f0d31baa",
  "https://note.com/hc3_henkan/n/n3cb0d1c9665e",
  "https://note.com/hc3_henkan/n/n0949d18d9fd3"
]];
const GachaTitleList = [""];

/* 抽選アニメGIF（1つでもOK） */
const gifs = ['animeRed.gif'];

/* 結果画像（PNG 4枚から1枚だけ出す） */
const ImagePool = [
  'result1.png',
  'result2.png',
  'result3.png',
  'result4.png'
];

document.addEventListener('DOMContentLoaded', () => {
  let GachaNum = 0;

  const jsModal = document.getElementById('gachaModal');
  const jamp = document.querySelector('.js-result');
  const gachaTitle = document.getElementById('gachaTitleTxt');
  const selectedGif = document.getElementById('playGif');

  const resultWrap = document.getElementById('resultWrap');
  const resultImg  = document.getElementById('resultImg');
  const resultLink = document.getElementById('resultLink');

  function Gacha(num){
    const k = Math.floor(Math.random()*GachaList[num].length);
    return GachaList[num][k];
  }
  function randomGif(){
    const j = Math.floor(Math.random()*gifs.length);
    selectedGif.src = gifs[j] + '?t=' + Date.now(); // 先頭から再生
  }
  function pickOneImage(pool){
    return pool[Math.floor(Math.random()*pool.length)];
  }
  function launchConfetti(count=100){
    for(let i=0;i<count;i++){
      const c=document.createElement('div');
      c.classList.add('confetti');
      const colors=['#f44336','#e91e63','#9c27b0','#3f51b5','#03a9f4','#4caf50','#ffeb3b','#ff9800'];
      c.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
      c.style.width = `${Math.random()*4+4}px`;
      c.style.height= `${Math.random()*8+10}px`;
      const dur = `${Math.random()*4+6}s`;
      c.style.animationDuration = dur;
      c.style.setProperty('--duration',dur);
      c.style.top="-10px";
      c.style.setProperty('--startX',Math.random()*100+'vw');
      c.style.setProperty('--endX',Math.random()*100+'vw');
      document.body.appendChild(c);
      setTimeout(()=>c.remove(),12000);
    }
  }

  // クリック時
  window.choiceGachaBox = function(tempNum){
    GachaNum = tempNum;
    gachaTitle.textContent = GachaTitleList[GachaNum];

    // 初期化：結果は隠す、リンクも隠す、GIFは見せる
    resultWrap.style.display = 'none';
    resultImg.classList.remove('show');
    resultLink.style.display = 'none';
    selectedGif.style.display = 'block';

    randomGif();
    launchConfetti(120);

    // モーダル表示 & 振動
    jsModal.style.display = 'block';
    // document.querySelector('.modal-content').style.animation = "flash 1s ease-in-out 3";
    // selectedGif.classList.add('shake');

    // GIF終了後に「GIFを消す → PNG 1枚だけ表示 → リンク表示」
    setTimeout(()=>{
      // 1) GIFを非表示
      // selectedGif.classList.remove('shake');
      selectedGif.style.display = 'none';

      // 2) PNG 1枚だけ
      const picked = pickOneImage(ImagePool);
      resultImg.src = picked;
      resultWrap.style.display = 'block';
      requestAnimationFrame(()=>resultImg.classList.add('show')); // フェードイン

      // 3) 文字リンク
      resultLink.href = Gacha(GachaNum);
      resultLink.style.display = 'inline-block';
    }, GIF_DURATION_MS);
  };

  // 閉じる
  jamp.addEventListener('click', ()=>{
    jsModal.style.display = 'none';
    selectedGif.classList.remove('shake');
  });

  // 外側クリックで閉じる
  // window.addEventListener('click',(e)=>{
  //   if(e.target===jsModal){
  //     jsModal.style.display='none';
  //     selectedGif.classList.remove('shake');
  //   }
  // });

  // 戻る・進む
  window.addEventListener('pageshow',(e)=>{
    jsModal.style.display='none';
    if(e.persisted){ window.location.reload(); }
  });
});
</script>

</body>
</html>




