<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>変環ガチャ！ | 名古屋大学 変換共創拠点</title>
</head>
<body>

<style>
.modal{position:fixed;left:0;top:0;display:none;z-index:9999;height:100%;width:100%;overflow:auto;background-color:rgba(0,0,0,0.5);}
.modal-header{border-bottom:1px solid #e4e4e4;padding:3px 20px;display:flex;justify-content:center;align-items:center;}
.modal-body{padding:20px;color:black;position:relative;z-index:0;}
.modal-content{background-color:#f4f4f4;border-radius:30px;margin:10% auto;width:90%;max-width:500px;}
#playGif{width:100%;height:auto;margin:auto;display:block;}

/* ▼ ガチャ筐体部分のセンタリング */
.gacha-wrap{
  display:flex;
  justify-content:center;   /* 中央寄せ */
  align-items:flex-start;
  flex-wrap:wrap;
  gap:20px;
  margin:20px 0;
}
.modal-btn{
  /* float を廃止し、箱自体を中央へ */
  float:none;
  display:inline-block;
  width:auto;
  max-width:100%;
  text-align:center;         /* 中のテキストを中央 */
  margin:10px auto;
  cursor:pointer;
}
.modal-btn img{
  display:block;
  margin:0 auto;            /* 画像を中央に */
  height:auto;
  max-width:100%;
}

/* ▼ 結果画像（最初は非表示） */
.result-wrap{margin-top:12px;position:relative;z-index:2;display:none;}
.result-img{width:100%;display:block;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.12);opacity:0;transition:opacity .6s ease;}
.result-img.show{opacity:1;}
.result-link{display:none;margin-top:16px;text-align:center;text-decoration:underline;color:#0b5bd3;font-weight:600;position:relative;z-index:2;}
</style>

<div id="gachaModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>変環ステッカーガチャ!　</h3>
      <h2 id="gachaTitleTxt"></h2>
    </div>
    <div class="modal-body">
      <img id="playGif" src="" alt="抽選のアニメーション">
      <p>ランダムで1枚表示されます。</p>

      <!-- ▼ 結果（PNG 1枚だけ） -->
      <div id="resultWrap" class="result-wrap">
        <img id="resultImg" class="result-img" src="" alt="ランダム結果">
      </div>

      <!-- ▼ 一番下の文字リンク -->
      <a id="resultLink" class="result-link" href="https://forms.gle/124FFLrSvFF9UdF97" target="_blank" rel="noopener">アンケートにもぜひご協力ください！</a>

      <!-- ▼ 閉じるボタンは非表示（削除済み） -->
    </div>
  </div>
</div>

<!-- ガチャ本体（筐体） -->
<div class="gacha-wrap">
  <div class="modal-btn" onclick="choiceGachaBox(0)">
    <img loading="lazy" src="image1.png" width="250" height="400" alt="論文・レポートのガチャ">
    <p>変環ステッカーガチャ<br>タップしてね！</p>
  </div>
</div>

<script>
/* ===== 設定 ===== */
const GIF_DURATION_MS = 7500; // GIFが終わるまでの待ち時間（必要なら調整）

/* ランダム記事（文字リンク用） */
const GachaList = [[
  "https://forms.gle/124FFLrSvFF9UdF97",
  "https://forms.gle/124FFLrSvFF9UdF97",
  "https://forms.gle/124FFLrSvFF9UdF97"
]];
const GachaTitleList = [""];

/* 抽選アニメGIF（1つでもOK） */
const gifs = ['animeRed.gif'];

/* 結果画像（PNG 4枚から1枚だけ出す） */
const ImagePool = [
  'result1.png',
  'result2.png',
  'result3.png',
  'result4.png'
];

document.addEventListener('DOMContentLoaded', () => {
  let GachaNum = 0;

  const jsModal = document.getElementById('gachaModal');
  const jamp = document.querySelector('.js-result'); // ない場合があるので後でnullチェック
  const gachaTitle = document.getElementById('gachaTitleTxt');
  const selectedGif = document.getElementById('playGif');

  const resultWrap = document.getElementById('resultWrap');
  const resultImg  = document.getElementById('resultImg');
  const resultLink = document.getElementById('resultLink');

  function Gacha(num){
    const k = Math.floor(Math.random()*GachaList[num].length);
    return GachaList[num][k];
  }
  function randomGif(){
    const j = Math.floor(Math.random()*gifs.length);
    selectedGif.src = gifs[j] + '?t=' + Date.now(); // 先頭から再生
  }
  function pickOneImage(pool){
    return pool[Math.floor(Math.random()*pool.length)];
  }

  // クリック時
  window.choiceGachaBox = function(tempNum){
    GachaNum = tempNum;
    gachaTitle.textContent = GachaTitleList[GachaNum];

    // 初期化：結果は隠す、リンクも隠す、GIFは見せる
    resultWrap.style.display = 'none';
    resultImg.classList.remove('show');
    resultLink.style.display = 'none';
    selectedGif.style.display = 'block';

    randomGif();

    // モーダル表示
    jsModal.style.display = 'block';

    // GIF終了後に「GIFを消す → PNG 1枚だけ表示 → リンク表示」
    setTimeout(()=>{
      selectedGif.style.display = 'none';

      const picked = pickOneImage(ImagePool);
      resultImg.src = picked;
      resultWrap.style.display = 'block';
      requestAnimationFrame(()=>resultImg.classList.add('show')); // フェードイン

      resultLink.href = Gacha(GachaNum);
      resultLink.style.display = 'inline-block';
    }, GIF_DURATION_MS);
  };

  // （ボタンを置かない構成なので安全のためnullチェック）
  if (jamp) {
    jamp.addEventListener('click', ()=>{
      jsModal.style.display = 'none';
    });
  }

  // 戻る・進む
  window.addEventListener('pageshow',(e)=>{
    jsModal.style.display='none';
    if(e.persisted){ window.location.reload(); }
  });
});
</script>

</body>
</html>


